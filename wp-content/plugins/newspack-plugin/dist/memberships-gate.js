(()=>{"use strict";const e=(e={},t={})=>{const n={...e};return t?.newspack_popup_id&&(n.newspack_popup_id=t.newspack_popup_id),t?.gate_post_id&&(n.gate_post_id=t.gate_post_id),t?.sso&&(n.sso=t.sso),n},t=(e,t="np_reader_activation_interaction")=>{if("function"==typeof window.gtag&&e){for(const t of Object.keys(e))"boolean"==typeof e[t]?e[t]=e[t]?"yes":"no":"true"===e[t]?e[t]="yes":"false"===e[t]&&(e[t]="no"),e[t]=e[t].toString();window.gtag("event",t,e)}};function n(e="log",...t){"true"===localStorage.getItem("newspack-reader-activation-debug")&&console["error"===e?"error":"log"](...t)}const o="np_gate_interaction",a={...newspack_memberships_gate.metadata,referrer:window.location.pathname};function i(e){return!!e&&e.offsetWidth>0&&e.offsetHeight>0}function c(t,n){return n&&(a.gate_has_donation_block=i(n.querySelector(".wp-block-newspack-blocks-donate"))?"yes":"no",a.gate_has_registration_block=i(n.querySelector(".newspack-registration"))?"yes":"no",a.gate_has_checkout_button=i(n.querySelector(".wp-block-newspack-blocks-checkout-button"))?"yes":"no",a.gate_has_registration_link=i(n.querySelector('a[href="#register_modal"]'))?"yes":"no",a.gate_has_signin_link=i(n.querySelector('a[href="#signin_modal"]'))?"yes":"no"),e({...t,...a})}function r(e){"function"==typeof window.gtag&&(!function(e){[...document.querySelectorAll(".newspack-reader-auth form"),...e.querySelectorAll(".newspack-registration form"),...e.querySelectorAll(".wp-block-newspack-blocks-checkout-button form"),...e.querySelectorAll(".wp-block-newspack-blocks-donate form")].forEach((n=>{if(!n.querySelector('input[name="memberships_content_gate"]')){const a=document.createElement("input");a.type="hidden",a.name="memberships_content_gate",a.value=newspack_memberships_gate.metadata?.gate_post_id||"1",n.appendChild(a),n.addEventListener("submit",(n=>function(e,n){if("function"!=typeof window.gtag)return;const a={action:"form_submission"},i=new FormData(e.target),r={};for(const e of i.entries())r[e[0]]=e[1];if(r["reader-activation-auth-form"]&&r.action&&(a.action_type="register"===r.action?"registration":"signin"),r.newspack_reader_registration&&(a.action_type="registration"),r.newspack_donate&&(a.action_type="donation",r.donation_currency&&(a.donation_currency=r.donation_currency),r.donation_frequency&&(a.donation_frequency=r.donation_frequency,r[`donation_value_${r.donation_frequency}`]&&(a.donation_amount=r[`donation_value_${r.donation_frequency}`],"other"===a.donation_amount&&r[`donation_value_${r.donation_frequency}_other`]&&(a.donation_amount=r[`donation_value_${r.donation_frequency}_other`])))),r.newspack_checkout){a.action_type="checkout_button";const t=e.target.getAttribute("data-checkout")?JSON.parse(e.target.getAttribute("data-checkout")):null;t&&Object.assign(a,t)}t(c(a,n),o)}(n,e)))}}))}(e),t(c({action:"seen"},e),o))}var s;s=function(){const e=document.querySelector(".newspack-memberships__gate");if(e)if(n("log","[Gate] initReloadHandler called"),window.newspackRAS=window.newspackRAS||[],window.newspackRAS.push((function(e){n("log","[Gate] RAS initialized");let a=!1;const i=function(i){if(n("log","[Gate] refreshPage called with event:",i),n("log","[Gate] Event detail:",i?.detail),n("log","[Gate] Event detail action:",i?.detail?.action),n("log","[Gate] Pending checkout:",window?.newspackReaderActivation?.getPendingCheckout()),i?.detail?.action&&"reader_registered"===i.detail.action&&!window?.newspackReaderActivation?.getPendingCheckout()&&(n("log","[Gate] reader_registered action detected"),a=!0),i?.detail?.overlays&&i.detail.removed){const e=window?.newspackReaderActivation?.getActivities();n("log","[Gate] Overlay removed, activities:",e);const i=e?.[e.length-1]||{},r=["checkout_completed","reader_registered","reader_logged_in","newsletter_signup"];e.length&&r.includes(i.action)?(n("log","[Gate] Valid action detected:",i.action),a=!0,document.body.classList.add("newspack-memberships__gate-passed")):(a=!1,"function"==typeof window.gtag&&t(c({action:"dismissed"}),o))}i?.detail?.action&&"reader_logged_in"===i.detail.action&&(n("log","[Gate] reader_logged_in action detected"),a=!0),setTimeout((()=>{const t=e.overlays.get(),o=window?.newspackReaderActivation?.getActivities();n("log","[Gate] Checking reload conditions - overlays:",t,"reload:",a),n("log","[Gate] Current activities:",o),!t.length&&a&&(n("log","[Gate] Reloading page!"),window.location.reload())}),5)};e.on("overlay",i),e.on("activity",i)})),e.classList.contains("newspack-memberships__overlay-gate"))!function(e){let t=document.querySelector(".entry-content");t||(t=document.querySelector("#content")),e.style.removeProperty("display");let n=!1;const o=()=>{let o=!1;(t?.getBoundingClientRect().top||0)-window.innerHeight/2<0&&(o=!0,n||r(e),n=!0),e.setAttribute("data-visible",o)};document.addEventListener("scroll",o),o()}(e);else{const t=()=>{(e?.getBoundingClientRect().top||0)-window.innerHeight/2<0&&"function"==typeof window.gtag&&(r(e),document.removeEventListener("scroll",t))};document.addEventListener("scroll",t),t()}},"undefined"!=typeof document&&("complete"!==document.readyState&&"interactive"!==document.readyState?document.addEventListener("DOMContentLoaded",s):s())})();